<html>
	<head>
		  

				<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

		<!-- Optional theme -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
		<link rel="stylesheet" href="{{ MEDIA_URL }}css/docs.min.css">

		<!-- Latest compiled and minified JavaScript -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
		<script>
		    
		    $( document ).ready(function() {

		    	var addAllDraggables  = function(){

			    	$(".dragImg").draggable({                                    
					   //use a helper-clone that is append to 'body' so is not 'contained' by a pane
					   activeClass: 'ui-state-hover',
					       helper: function() {
					            return $(this).clone().appendTo('body').css({
					                'zIndex': 5
					                })
					            },
					           
					           revert: true
						       
					    });
					   
					    $('.outer').droppable({
					       
					        accept: '.dragImg',
						    hoverClass: "ui-state-hover", 
					        activeClass: 'ui-state-hover',
					        
					        drop: function(event, ui) {
					            alert("Dropped in outer Div");
					            if (!ui.draggable.hasClass("dropped")){                                       
					                 $(this).append(
					                     $(ui.draggable).clone()
					                     .addClass("dropped")
					                     .draggable()); 
					                   }
					             } 
					      });

					    $('#iframe_1').droppable({
					       greedy: true,
					        accept: '.dragImg',
					         activeClass: 'ui-state-hover',
					         hoverClass: "ui-state-hover",
					        drop: function(event, ui) {
					            alert("Inner Dropped");
					            if (!ui.draggable.hasClass("dropped")){                                       
					                 $(this).append(
					                     $(ui.draggable).clone()
					                     .addClass("dropped").draggable()); 
					                   }
					             } 
					            
					        });
				   }

				var openPageInIframe = function(){

					active_frame = $("#iframes_container").attr("active-iframe");
					id_aviso = $(this).attr("id_aviso")
					console.log(id_aviso);

					if(active_frame=="1") {
						$("#iframe_2").attr("src", "/redirect_to_aviso/"+id_aviso);
						$("#iframes_container").attr("active-iframe","2");
					}else if(active_frame=="2" || active_frame=="0") {
						$("#iframe_1").attr("src", "/redirect_to_aviso/"+id_aviso);
						$("#iframes_container").attr("active-iframe","1");
					}


 					
				}

		    	var findEqualsFiltered = function(){

				    var elem = $("#dataContainer")
				    var last_id = $(this).attr("last-id")

				    $.get('/filtered/', {id_aviso: last_id}, function(data){

		                var complete_html = ""
		                var number_of_ads = 0;

		                $.each(data, function() {
						  	line = ""

						  	for (var property in this) {
							    if (this.hasOwnProperty(property)) {
							        console.log(property);
							        if (property!="equal_filters" && property!="reas") {

								        $.each(this[property], function() {
											line += "<div><u><b>" + property + "</u></b></div><div class='row' style='margin-left:5px'><div class='col-xs-2'><div style='overflow-x: hidden;white-space: nowrap;' title='" + this.value + "'><b>" + this.value + "</b></div></div>"
									 		line += '<div id="col-xs-10"><div style="overflow-x: scroll;white-space: nowrap;">'
									 		$.each(this.ida, function() {
									 			line += '<a class="id_to_photo" style="cursor:pointer" id_aviso="' + this + '">' + this + '</a> '
									 		});
									 		line += '</div></div></div><br>'
									 		
										});
								       
								        complete_html += line
									 	line = ""
									}

									$('#all_fields').html(complete_html);

							    }
							}
						  	
						  	$('.id_to_photo').click(openPageInIframe);

						 	$("#iframe_1").attr("src", "");
						 	$("#iframe_2").attr("src", "");
						 	$("#iframes_container").attr("active-iframe","0");

						 	$('#myModal').modal('show')
						 	
						});

		               addAllDraggables();
		           });
				}

		    	
		    	
		    	var findEquals = function(){

				    var type = $(this).attr("type")

				    var elem = $(this)
				    var this_parent = $(this).parent()
				    var elem_dataContainer = $("#dataContainer")

				    
				    
				    // if (type=='initial' && $('#info_container'+number_groups + '_' + number_ads).css('display') == 'block') {
				    // 	$('#info_container'+number_groups + '_' + number_ads).css({"display":'none'});
				    // 	$('.nextButton').css({"display":'none'});
				    // 	$('.prevButton').css({"display":'none'});
				    // } else {

					    if (type=='initial') {
		                	


		                	number_ads = elem.attr("number-ads");
						    number_groups = elem.attr("number-groups");
						    pagination_str = elem.attr("pagination")

						    elem_dataContainer.attr("number-ads", number_ads);
						    elem_dataContainer.attr("number-groups", number_groups);
						    elem_dataContainer.attr("pagination", pagination_str);											    
		                	
		                } else if (type=='next') {
		                	elem_dataContainer.attr("pagination", (parseInt(pagination_str) + 10).toString());
		                	pagination_str = elem_dataContainer.attr("pagination")
		                } 

					    $.get('/group/', {number_of_ads: number_ads, pagination: pagination_str, action: type}, function(data){

			                var complete_html = ""
			                var number_of_ads = 0;

			                var last_id = 0;
 
			                $.each(data, function() {
							   	line = ""
								equals_filters = parseInt(this.equal_filters)
							 	
							 	$.each(this.reas, function() {
							 		line += this + " &nbsp;";
							 		last_id = this
							 	});

							 	bg_color = "rgb(8, 166, 245);"

							 	if (equals_filters>7)
							 		bg_color = "rgba(245, 8, 8, 1);"
			               		
							 	complete_html +=  '<li class="list-group-item groupButton" last-id="' + last_id + '" style="color: ' + bg_color + ';font-weight:bold;overflow-x: scroll;"><span style="padding: 5px;border-radius: 3px;cursor:pointer;" >' + line + '</span></li>'

							 	number_of_ads++;
							});

			              	// elem_dataContainer.attr("last-id", last_id);            

			              	// $('#info_container'+number_groups + '_' + number_ads).html(complete_html);
			               // 	$('#info_container'+number_groups + '_' + number_ads).css({"display":'block'});
			               	
			               	$("#dataContainer").html(complete_html);
			               	$("#dataContainer").attr("number-ads", number_ads);
			               	$("#dataContainer").attr("number-groups", number_groups);

			               	$('.groupButton').click(findEqualsFiltered);

			                if (type=='prev'){
								elem_dataContainer.attr("pagination", (parseInt(pagination_str) - 10).toString());
								pagination_str = elem_dataContainer.attr("pagination")
			                }

			                if (parseInt(pagination_str)>=0 && number_of_ads>=10) {
			               		$(".nextButton").css({"display":'inline'});
			                } else if (number_of_ads<10) {
			               		$(".nextButton").css({"display":'none'});
			                }

			                if (parseInt(pagination_str)>0) {
			               		$(".prevButton").css({"display":'inline'});
			                } else {
			               		$(".prevButton").css({"display":'none'});
			                }
	                    });
					// }
				}

			
				    
				   
				 

				$('.equal_button').click(findEquals);
		    	$('.nextButton').click(findEquals);
		    	$('.prevButton').click(findEquals);
				
			});
		</script>
		<style>

			#inner {
			     width: 100px;
			    height: 100px;
			    border: 1px solid black;
			    margin: 150px auto; 
			}

			.ui-state-hover {
			    background-color: 5px solid orange;   
			    border:10px solid #000;
			    color:#ff00ff;
			}
			
			#dropHere {
			    width:400px;
			    height: 400px;
			    border: dotted 1px black;
			    
			}
		</style>
	</head>
	
	<body>
<!-- 
	<header class="navbar navbar-static-top bs-docs-nav" id="top" role="banner">
	  <div class="container">
		<div class="navbar-header">
		  <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
			<span class="sr-only">Toggle navigation</span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		  </button>
		  <a href="../" class="navbar-brand">Bootstrap</a>
		</div>
		<nav id="bs-navbar" class="collapse navbar-collapse">
		  <ul class="nav navbar-nav">
			<li>
			  <a href="../getting-started/">Getting started</a>
			</li>
			<li>
			  <a href="../css/">CSS</a>
			</li>
			<li class="active">
			  <a href="../components/">Components</a>
			</li>
			<li>
			  <a href="../javascript/">JavaScript</a>
			</li>
			<li>
			  <a href="../customize/">Customize</a>
			</li>
		  </ul>
		  <ul class="nav navbar-nav navbar-right">
			<li><a href="http://themes.getbootstrap.com" onclick="ga('send', 'event', 'Navbar', 'Community links', 'Themes');">Themes</a></li>
			<li><a href="http://expo.getbootstrap.com" onclick="ga('send', 'event', 'Navbar', 'Community links', 'Expo');">Expo</a></li>
			<li><a href="http://blog.getbootstrap.com" onclick="ga('send', 'event', 'Navbar', 'Community links', 'Blog');">Blog</a></li>
		  </ul>
		</nav>
	  </div>
	</header>
 -->

      <!-- <div class="container">
        <h1>Components</h1>
        <p>Over a dozen reusable components built to provide iconography, dropdowns, input groups, navigation, alerts, and much more.</p>
    </div> -->
	<div style="padding:15px">
		<h2>All Duplicated Ads - Photo Analysis</h2>
		<hr>

		<div class="row">
			<div class="col-xs-3" style="height: 420px;overflow-y: scroll;">
				{% if duplicateds_avisos_filtered %}
					
					<ul class="list-group">
						{% for filters in duplicateds_avisos_filtered %}
						  <li class="list-group-item">
						  	<span class="equal_button" id="equal_button{{filters.nog }}_{{ filters.noe }}" number-ads="{{ filters.noe }}" number-groups="{{ filters.nog }}" pagination="0" type="initial" style="cursor:pointer;" ><b>{{ filters.noe }}</b> avisos per group (<b>{{ filters.nog }}</b> groups) &nbsp;<span class="glyphicon glyphicon glyphicon-log-out" aria-hidden="true"></span></span>

						  </li>
						{% endfor %}
					</ul>
				{% else %}
					<p>No duplicated avisos.</p>
				{% endif %}
			</div>
			<div class="col-xs-9" style="white-space: nowrap;overflow-x: scroll;">
				<ul class="list-group" id="dataContainer" number-ads="" number-groups="" pagination="0">
				</ul>
				<span style="cursor:pointer;display:none;" type='prev' class="prevButton">Prev </span><span style="cursor:pointer;display:none" class="nextButton" type="next" > Next</span>

			</div>
		</div>

		<hr>
		<h2>Statistics</h2>
		# online ads: <b>940.944</b>
		<br>
		# avisos that have (at least) one photo equal to (at least) one photo of an other aviso: <b>231.632 (24%)</b>
		<br>
		# avisos that have +90% of its photos equal to +90% of the photos of another aviso: <b>104.094 (11%)</b>
		<br>
		# groups of equal avisos, grouped by its similarity: <b>36.567 (3,88%)</b>
		<br>
		# groups of equal avisos that have all filters equal: <b>15.042 (1,6%)</b>
		<br>
	</div>




		<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document" style="width:100%;">
    <div class="modal-content"  style="width:100%;">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">We grouped the avisos by its main characteristics.</h4>
      </div>
      <div class="modal-body">
       		<div class="row">
       			<div class="col-xs-4" id="all_fields">
      	
						
					</div>
					<div class="col-xs-8">
						<div class="row" class="outer" id="iframes_container" active-iframe="0">
						  	<div class="col-xs-6">
								<div class="ui-droppable" style="width: 100%;height: 450px;overflow : scroll;position : relative;background-color:#ededed;">
									<iframe id="iframe_1" src="" style="
						    			position: absolute;          
									    left: -86px;     
									    top: -220px;
									    width: 120%;     
									    height: 1300px;" id="my-iframe" scrolling="no"></iframe>
								</div>
						 	 </div>
						 	 <div class="col-xs-6">
								<div style="width: 100%;height: 450px;overflow : scroll;position : relative;background-color:#ededed;">
									<iframe id="iframe_2" src="" style="
						    			position: absolute;          
									    left: -86px;     
									    top: -220px;
									    width: 120%;     
									    height: 1300px;" id="my-iframe" scrolling="no"></iframe>
								</div>
						 	 </div>
						</div>
					</div>

      </div>
      
    </div>
  </div>


	</body>
</html